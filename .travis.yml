language: c

compiler:
  - gcc
  - clang

sudo: required

arch:
  packages:
    - qt5-declarative
    - qt5-quickcontrols2
    - extra-cmake-modules
    - kwallet
    - solid
    - networkmanager-qt
    - modemmanager-qt
    - pulseaudio
    - libqtxdg
    - xorg-server-xvfb
    - clang
  script:
    - curl -L "https://dl.bintray.com/qmlos/ci/fluid-$CC.tar.xz" | sudo tar xJf - -C /
    - if [ "$CC" = "gcc" ]; then cmake . -DKDE_INSTALL_USE_QT_SYS_PATHS=ON -DCMAKE_INSTALL_PREFIX=/usr -DKDE_INSTALL_LIBDIR=lib; fi
    - if [ "$CC" = "clang" ]; then cmake . -DKDE_INSTALL_USE_QT_SYS_PATHS=ON -DCMAKE_INSTALL_PREFIX=/usr -DKDE_INSTALL_LIBDIR=lib; fi
    - make
    - sudo make install
    - xvfb-run -a -s "-screen 0 800x600x24" make check
    - ./.travis/bintray.sh

script:
  - "curl -s https://raw.githubusercontent.com/mikkeloscar/arch-travis/master/arch-travis.sh | bash"

deploy:
  on: develop
  provider: bintray
  file: build/bintray.json
  user: plfiorini
  key:
    secure: H5pp2Sckx6XjSHUELeOTJjCZ1IrMf1yCKWzXRTn05xYbimkGachqbWqO9dMlganmZoP8m41xpwoRDDB3DV3hdMptwxxCS65zg4I7y9/VxZ+5PmU5R1PPQcR18bMBjfXMR5slKjc/ueg3TVuQCYCVD4K8VPbGeP+g636hUomtFp0SEjomZZMePFYAuZA/V8U6XeHJR4C/BLo+8gy7uFFgQZ2HFBl5X8S9pymKCuSQ8M0HpJkbpvy6Ma5GwTg79HC3ODXJ0xdFqaNQStrt8kFcNvsXCaYMBHwHgaEU3y6FZb490lDvHYyABrUn3m2Krn3E36dDRzvyLJNZX4JeGUo5EUpIvNFO+wq70ExqGTz6B/IL3Z3vPNRzF9JaZLkLeSfI3cpOfJEpuBpyNxgVAHBhtcL9QFl2KJu5e7ot9dES9sxZso5LTrOtlqxltnLVJohL46Q1MVcoDDv6Pm8Z6QPcls4lrVR8s+qWrVdUF6lwJZ0T5N/fosINfFoDTZntsMn6EvNsOAo1XPrQ0NKbEFrIdrYqs1wDCb4ndn9ItNFsT0H+Hy+0EgyHW/GKvIJBxZSRKt4bZc2uXXqpRA4/2t/3fezfqEQAq+OAqgjmBH+2+n2x81moRqudTGBA+L62CtZH2utiVGJQS/xaIWHX48UWEQG2B9MRUFrFWgin0HnHGaU=

notifications:
  email: false
  slack: qmlos:fdUqVmPzqPskEL1UBhqapZ0w
